#local
#include Helper.cpd
#include RebarLookups.cpd
#include CMULookups.cpd
#include Load_Combos.cpd
f′_m = ? {2000}psinote$('CMU Compressive Strength')
f_y = ? {60}ksinote$('Rebar Yield Strength')
F_s = ? {32}ksinote$('Allowable stress in rebar')ref$('TMS 402 Section 8.3.3')
E_s = ? {29000}ksi
F_b = 0.45*f′_m
E_m = 900*f′_m
n = E_s/E_m
w_hgt = 20ft
M_a = 10kip*ft
V_a = 5kip
P_a = 1kip
M_aLC = [10kip*ft; 20kip*ft]
V_a = 5kip
P_aLC = [1kip; 3kip]
CMU$(8in; 32in; )
#global
#def getMn$(M_n$; A_s$; d$)
	ρ_smn = A_s$/(d$*12in)
	k_mn = sqrt(2*ρ_smn*n + (ρ_smn*n)^2) - ρ_smn*n
	j_mn = 1 - k_mn/3
	M_m = 0.5*F_b*k_mn*j_mn*12in*d$^2
	M_s = A_s$*F_s*j_mn*d$
	M_n$ = min(M_m; M_s)
#end def
'
#def getVn$(V_n$; M_a$; V_a$; P_a$; d$; A_n$; y_g$)
	ratio_vn = min(M_a$/(V_a$*d$); 1)
	#if ratio_vn ≤ 0.25
		F_v = 3*sqrt(f′_m)*sqrt(1psi)note$('M/(V*d) ≤ 0.25')
	#else if ratio_vn ≥ 1
		F_v = 2*sqrt(f′_m)*sqrt(1psi)note$('M/(V*d) ≥ 1')
	#else
		F_v = (3*sqrt(f′_m) - ((ratio_vn - 0.25)/0.75)*sqrt(f′_m))*sqrt(1psi)|psinote$('0.25 < M/(V*d) < 1')
	#end if
	F_vm = 0.5*((4 - 1.75*ratio_vn)*sqrt(f′_m)*sqrt(1psi)) + 0.25*P_a$/A_n$|psi
	V_n$ = min(F_v; F_vm)*A_n$*y_g$
#end def
'
#def getPn$(P_n$; A_s$; A_n$; r_g$; w_ht$)
	#if w_ht$/r_g$ ≤ 99
		P_n$ = (0.25*f′_m*A_n$ + 0.65*A_s$*F_s*(1 - (w_ht$/(140*r_g$))^2))
	#else
		P_n$ = (0.25*f′_m*A_n$ + 0.65*A_s$*F_s*(70*r_g$/w_ht$)^2)
	#end if
#end def
'
#def getFf$(F_f$; M_a$; V_a$; P_a$; d_v$; A_sp$; u$)
	F_f,high = max(u$*(A_sp$*F_s + P_a$); 0kip)ref$('TMS 402-16 Equ 8-28')
	F_f,low = max(0.65*(0.6*A_sp$*F_s + P_a$); 0kip)
	#if M_a$/(V_a$*d_v$) ≤ 0.5
		F_f$ = F_f,high
	#else if M_a$/(V_a$*d_v$) ≥ 1
		F_f$ = F_f,low
	#else
		F_f$ = (F_f,high - F_f,low)/0.5*M_a$/(V_a$*d_v)
	#end if
#end def
'
#def getCom$(f_ab$; M_aLC$; P_aLC$; A_s$; A_n$; d$; I_N$)
	hide$
	f_a,bLC = vector(len(P_aLC$))
	unhide$
	ρ_smn = A_s$/(d$*12in)
	k_mn = sqrt(2*ρ_smn*n + (ρ_smn*n)^2) - ρ_smn*n
	hide$
	#for itr = 1 : len(P_aLC$)
		f_a = P_aLC$.itr/A_n$
		x = k_mn*d$
		f_b = M_aLC$.itr*x/I_N$
		f_a,bLC.itr = abs(f_a) + abs(f_b)
	#loop
	unhide$
	'Sum of compression stresses from axial and compression loads for each load combo
	f_a,bLC
	f_ab$ = max(f_a,bLC)|psi
#end def
#local
A_s = rebarAreaNum$(5; 1)
d = 8in
getMn$(M_n; A_s; 3.5in)
getVn$(V_n; M_a; V_a; P_a; 3.5in; A_n; 0.75)
getPn$(P_n; A_s; A_n; r; w_hgt)
getCom$(f_ab; M_aLC; P_aLC; A_s; A_n; d; I_N)