<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalcPad UI</title>
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <div class="calcpad-ui">
        <div class="tab-container">
            <button class="tab active" onclick="switchTab('insert-tab')">Insert</button>
            <button class="tab" onclick="switchTab('settings-tab')">Settings</button>
            <button class="tab" onclick="switchTab('pdf-tab')">PDF</button>
            <button class="tab" onclick="switchTab('variables-tab')">Variables</button>
            <button class="tab" onclick="switchTab('files-tab')">Files</button>
        </div>

        <div class="tab-content active" id="insert-tab">
            <div id="insert-container">
                <input
                    id="insert-search-input"
                    type="text"
                    placeholder="Search items..."
                    v-model="searchTerm"
                    style="width: 100%; margin-bottom: 8px; padding: 8px; background: var(--vscode-input-background); border: 1px solid var(--vscode-input-border); color: var(--vscode-input-foreground); border-radius: 3px; font-size: 12px;"
                />
                <div v-if="searchTerm && filteredItems.length === 0" style="padding: 20px; text-align: center; color: var(--vscode-descriptionForeground);">
                    No items found for "{{ searchTerm }}"
                </div>
                <div v-else-if="displayItems.length === 0" style="padding: 20px; text-align: center; color: var(--vscode-descriptionForeground);">
                    No insert items available
                </div>
                <div v-else-if="searchTerm" style="max-height: 400px; overflow-y: auto;">
                    <div v-for="item in displayItems" :key="item.tag" @click="insertItem(item)" class="insert-item" style="padding: 8px; margin: 2px 0; border: 1px solid var(--vscode-widget-border); border-radius: 3px; cursor: pointer; background: var(--vscode-editor-background); transition: border-color 0.2s;">
                        <div class="insert-item-tag" style="font-weight: bold; color: var(--vscode-editor-foreground);">{{ item.tag }}</div>
                        <div v-if="item.label && item.label !== item.tag" class="insert-item-label" style="font-size: 11px; color: var(--vscode-descriptionForeground); margin-top: 2px;">{{ item.label }}</div>
                        <div v-if="item.description" class="insert-item-description" style="font-size: 11px; color: var(--vscode-descriptionForeground); margin-top: 2px;">{{ item.description }}</div>
                        <div v-if="item.categoryPath" class="insert-item-category" style="font-size: 10px; color: var(--vscode-descriptionForeground); margin-top: 2px;">{{ item.categoryPath }}</div>
                    </div>
                </div>
                <div v-else id="tree-container" style="max-height: 400px; overflow-y: auto;">
                    <div style="display: flex; justify-content: flex-end; margin-bottom: 8px;">
                        <button @click="collapseAll" style="background: var(--vscode-button-background); color: var(--vscode-button-foreground); border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;">
                            Collapse All
                        </button>
                    </div>
                    <!-- Tree structure will be built here by JavaScript -->
                </div>
            </div>
        </div>

        <div class="tab-content" id="settings-tab">
            <div class="settings-container">
                <h3>Math Settings</h3>
                <div class="setting-group">
                    <label for="decimals">Decimal Places:</label>
                    <input type="number" id="decimals" min="0" max="15" value="6">
                </div>
                <div class="setting-group">
                    <label for="degrees">Angle Units:</label>
                    <select id="degrees">
                        <option value="0">Degrees</option>
                        <option value="1">Radians</option>
                        <option value="2">Gradians</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="isComplex">
                        <input type="checkbox" id="isComplex"> Enable Complex Numbers
                    </label>
                </div>
                <div class="setting-group">
                    <label for="substitute">
                        <input type="checkbox" id="substitute" checked> Show Variable Substitution
                    </label>
                </div>
                <div class="setting-group">
                    <label for="formatEquations">
                        <input type="checkbox" id="formatEquations" checked> Format Equations
                    </label>
                </div>

                <h3>Plot Settings</h3>
                <div class="setting-group">
                    <label for="isAdaptive">
                        <input type="checkbox" id="isAdaptive" checked> Adaptive Plotting
                    </label>
                </div>
                <div class="setting-group">
                    <label for="screenScaleFactor">Screen Scale Factor:</label>
                    <input type="number" id="screenScaleFactor" min="0.5" max="4" step="0.1" value="2">
                </div>
                <div class="setting-group">
                    <label for="vectorGraphics">
                        <input type="checkbox" id="vectorGraphics"> Use Vector Graphics
                    </label>
                </div>
                <div class="setting-group">
                    <label for="colorScale">Color Scale:</label>
                    <select id="colorScale">
                        <option value="Rainbow">Rainbow</option>
                        <option value="Grayscale">Grayscale</option>
                        <option value="Hot">Hot</option>
                        <option value="Cool">Cool</option>
                        <option value="Jet">Jet</option>
                        <option value="Parula">Parula</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="smoothScale">
                        <input type="checkbox" id="smoothScale"> Smooth Color Transitions
                    </label>
                </div>
                <div class="setting-group">
                    <label for="shadows">
                        <input type="checkbox" id="shadows" checked> Enable 3D Shadows
                    </label>
                </div>
                <div class="setting-group">
                    <label for="lightDirection">Light Direction:</label>
                    <select id="lightDirection">
                        <option value="North">North</option>
                        <option value="NorthEast">North East</option>
                        <option value="East">East</option>
                        <option value="SouthEast">South East</option>
                        <option value="South">South</option>
                        <option value="SouthWest">South West</option>
                        <option value="West">West</option>
                        <option value="NorthWest" selected>North West</option>
                    </select>
                </div>

                <h3>Preview</h3>
                <div class="setting-group">
                    <label for="previewTheme">Preview Theme:</label>
                    <select id="previewTheme">
                        <option value="system">Follow VS Code Theme</option>
                        <option value="light">Always Light</option>
                        <option value="dark">Always Dark</option>
                    </select>
                </div>

                <h3>Server</h3>
                <div class="setting-group">
                    <label for="serverUrl">Server URL:</label>
                    <input type="text" id="serverUrl" placeholder="http://localhost:9420">
                </div>

                <h3>S3 Storage</h3>
                <div class="setting-group">
                    <button id="open-s3-config" class="reset-button" style="margin-top: 0;">
                        üìù Edit S3 API Config
                    </button>
                    <small style="display: block; margin-top: 4px; color: var(--vscode-descriptionForeground); font-size: 11px;">
                        Configure S3 storage URL and settings for the Files tab
                    </small>
                </div>

                <h3>Units & Output</h3>
                <div class="setting-group">
                    <label for="units">Unit System:</label>
                    <select id="units">
                        <option value="m">Metric</option>
                        <option value="i">Imperial</option>
                        <option value="u">US</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="outputFormat">Output Format:</label>
                    <select id="outputFormat">
                        <option value="html">HTML</option>
                        <option value="pdf">PDF</option>
                        <option value="docx">DOCX</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="silent">
                        <input type="checkbox" id="silent" checked> Silent Mode
                    </label>
                </div>

                <div class="setting-group">
                    <button id="reset-settings" class="reset-button">Reset to Defaults</button>
                </div>
            </div>
        </div>

        <div class="tab-content" id="pdf-tab">
            <div class="settings-container">
                <h3>Header Settings</h3>
                <div class="setting-group">
                    <label for="enableHeader">
                        <input type="checkbox" id="enableHeader" checked> Enable Header
                    </label>
                </div>
                <div class="setting-group">
                    <label for="documentTitle">Document Title:</label>
                    <input type="text" id="documentTitle" placeholder="Auto-detected from filename">
                </div>
                <div class="setting-group">
                    <label for="documentSubtitle">Document Subtitle:</label>
                    <input type="text" id="documentSubtitle" placeholder="Optional subtitle">
                </div>
                <div class="setting-group">
                    <label for="headerCenter">Header Center Text:</label>
                    <input type="text" id="headerCenter" placeholder="Center header text">
                </div>
                <div class="setting-group">
                    <label for="author">Author:</label>
                    <input type="text" id="author" placeholder="Document author">
                </div>

                <h3>Footer Settings</h3>
                <div class="setting-group">
                    <label for="enableFooter">
                        <input type="checkbox" id="enableFooter" checked> Enable Footer
                    </label>
                </div>
                <div class="setting-group">
                    <label for="footerCenter">Footer Center Text:</label>
                    <input type="text" id="footerCenter" placeholder="Center footer text">
                </div>
                <div class="setting-group">
                    <label for="company">Company:</label>
                    <input type="text" id="company" placeholder="Company name">
                </div>
                <div class="setting-group">
                    <label for="project">Project:</label>
                    <input type="text" id="project" placeholder="Project name">
                </div>
                <div class="setting-group">
                    <label for="showPageNumbers">
                        <input type="checkbox" id="showPageNumbers" checked> Show Page Numbers
                    </label>
                </div>

                <h3>Page Layout</h3>
                <div class="setting-group">
                    <label for="pdfFormat">Page Format:</label>
                    <select id="pdfFormat">
                        <option value="A4" selected>A4</option>
                        <option value="A3">A3</option>
                        <option value="A5">A5</option>
                        <option value="Letter">Letter</option>
                        <option value="Legal">Legal</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="pdfOrientation">Orientation:</label>
                    <select id="pdfOrientation">
                        <option value="portrait" selected>Portrait</option>
                        <option value="landscape">Landscape</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="marginTop">Top Margin:</label>
                    <input type="text" id="marginTop" value="2cm" placeholder="e.g., 2cm, 1in, 20px">
                </div>
                <div class="setting-group">
                    <label for="marginBottom">Bottom Margin:</label>
                    <input type="text" id="marginBottom" value="2cm" placeholder="e.g., 2cm, 1in, 20px">
                </div>
                <div class="setting-group">
                    <label for="marginLeft">Left Margin:</label>
                    <input type="text" id="marginLeft" value="1.5cm" placeholder="e.g., 1.5cm, 1in, 15px">
                </div>
                <div class="setting-group">
                    <label for="marginRight">Right Margin:</label>
                    <input type="text" id="marginRight" value="1.5cm" placeholder="e.g., 1.5cm, 1in, 15px">
                </div>

                <h3>Content Options</h3>
                <div class="setting-group">
                    <label for="printBackground">
                        <input type="checkbox" id="printBackground" checked> Print Background Colors
                    </label>
                </div>
                <div class="setting-group">
                    <label for="pdfScale">Scale Factor:</label>
                    <input type="number" id="pdfScale" min="0.1" max="2.0" step="0.1" value="1.0">
                </div>

                <div class="setting-group">
                    <button id="reset-pdf-settings" class="reset-button">Reset PDF Settings to Defaults</button>
                </div>
            </div>
        </div>

        <div class="tab-content" id="variables-tab">
            <input
                id="variables-search-input"
                type="text"
                placeholder="Search variables, macros, functions..."
                style="width: 100%; margin-bottom: 8px; padding: 8px; background: var(--vscode-input-background); border: 1px solid var(--vscode-input-border); color: var(--vscode-input-foreground); border-radius: 3px; font-size: 12px;"
            />
            <div id="variables-container">
                <div class="loading">Loading variables...</div>
            </div>
        </div>

        <div class="tab-content" id="files-tab">
            <!-- S3 Login Form -->
            <div v-if="!s3State.isAuthenticated" class="s3-login-container">
                <h3>S3 Storage Login</h3>
                <div v-if="s3State.error" class="error" style="display: block; margin-bottom: 10px; padding: 8px; background-color: var(--vscode-inputValidation-errorBackground); border: 1px solid var(--vscode-inputValidation-errorBorder); border-radius: 3px;">
                    {{ s3State.error }}
                </div>
                <form @submit.prevent="s3Login">
                    <div class="form-group">
                        <label>Username</label>
                        <input id="s3-username" type="text" required :disabled="s3State.loading" style="width: 100%; padding: 8px; background: var(--vscode-input-background); border: 1px solid var(--vscode-input-border); color: var(--vscode-input-foreground); border-radius: 3px; font-size: 12px;">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input id="s3-password" type="password" required :disabled="s3State.loading" style="width: 100%; padding: 8px; background: var(--vscode-input-background); border: 1px solid var(--vscode-input-border); color: var(--vscode-input-foreground); border-radius: 3px; font-size: 12px;">
                    </div>
                    <button type="submit" :disabled="s3State.loading" style="width: 100%; padding: 10px; background: var(--vscode-button-background); color: var(--vscode-button-foreground); border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">
                        {{ s3State.loading ? 'Logging in...' : 'Login' }}
                    </button>
                </form>
            </div>

            <!-- Main S3 Application -->
            <div v-if="s3State.isAuthenticated" class="s3-main">
                <div class="s3-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid var(--vscode-widget-border);">
                    <span>Welcome, {{ s3State.currentUser ? s3State.currentUser.username : 'User' }}</span>
                    <button @click="s3Logout" style="background: var(--vscode-button-background); color: var(--vscode-button-foreground); border: none; padding: 6px 12px; border-radius: 3px; cursor: pointer; font-size: 11px;">
                        Logout
                    </button>
                </div>

                <!-- Error display for authenticated state -->
                <div v-if="s3State.error" class="error" style="display: block; margin-bottom: 10px; padding: 8px; background-color: var(--vscode-inputValidation-errorBackground); border: 1px solid var(--vscode-inputValidation-errorBorder); border-radius: 3px;">
                    {{ s3State.error }}
                </div>

                <!-- S3 Files Content -->
                <div class="s3-content">
                    <div class="s3-filters" style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <input v-model="s3State.searchQuery" placeholder="Search files..." style="flex: 1; padding: 8px; background: var(--vscode-input-background); border: 1px solid var(--vscode-input-border); color: var(--vscode-input-foreground); border-radius: 3px; font-size: 12px;">
                        <button @click="s3RefreshFiles" :disabled="s3State.loading" style="background: var(--vscode-button-background); color: var(--vscode-button-foreground); border: none; padding: 8px 12px; border-radius: 3px; cursor: pointer; font-size: 11px;">
                            {{ s3State.loading ? 'Loading...' : 'Refresh' }}
                        </button>
                    </div>

                    <div class="s3-files-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; max-height: 400px; overflow-y: auto;">
                        <div v-if="s3State.loading && s3State.files.length === 0" style="grid-column: 1 / -1; text-align: center; padding: 20px; color: var(--vscode-descriptionForeground);">
                            Loading files...
                        </div>
                        <div v-else-if="s3FilteredFiles.length === 0 && !s3State.loading" style="grid-column: 1 / -1; text-align: center; padding: 20px; color: var(--vscode-descriptionForeground);">
                            {{ s3State.searchQuery ? 'No files match your search' : 'No files found' }}
                        </div>
                        <div v-else v-for="file in s3FilteredFiles" :key="file.fileName" @click="s3SelectFile(file)" class="s3-file-card" style="padding: 12px; border: 1px solid var(--vscode-widget-border); border-radius: 5px; cursor: pointer; background: var(--vscode-editor-background); transition: border-color 0.2s;" @mouseover="$event.target.style.borderColor = 'var(--vscode-focusBorder)'" @mouseleave="$event.target.style.borderColor = 'var(--vscode-widget-border)'">
                            <div class="s3-file-name" style="font-weight: bold; margin-bottom: 5px; color: var(--vscode-editor-foreground); word-break: break-word;">
                                {{ file.fileName }}
                            </div>
                            <div class="s3-file-meta" style="font-size: 11px; color: var(--vscode-descriptionForeground);">
                                Size: {{ s3FormatFileSize(file.size) }}<br>
                                Modified: {{ new Date(file.lastModified).toLocaleDateString() }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
        // Inject insert data for the webview
        const insertData = PLACEHOLDER_INSERT_DATA;
    </script>
    <script src="PLACEHOLDER_MAIN_JS_URI"></script>
    <script src="PLACEHOLDER_S3_MANAGER_JS_URI"></script>
</body>
</html>